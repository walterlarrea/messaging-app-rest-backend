import{j as r,B as u}from"./Button.n99La9x2.js";import{r as p}from"./index.LFf77hJu.js";import{a as d,b as c}from"./axios.E8fTPdp3.js";import{u as h}from"./useAuth.LacpFR1K.js";import"./messages.3502c30d.z5n3LM_9.js";const m=n=>async o=>await n.post("/api/channel",o).then(t=>t.data).catch(t=>{const a=t.response?.data;return Promise.reject(a)}),j=()=>{const{setAuth:n}=h();return async()=>{const t=await d.get("/refresh",{withCredentials:!0});return n({accessToken:t.data.accessToken}),t.data.accessToken}},x=n=>{const{auth:o}=h(),t=j();return p.useEffect(()=>{const a=c.interceptors.request.use(e=>(e.headers.Authorization||(e.headers.Authorization=`Bearer ${o?.accessToken}`),e),e=>Promise.reject(e)),i=c.interceptors.response.use(e=>e,async e=>{const s=e?.config;if(e.response.status===403&&!s?.sent){s.sent=!0;const l=await t();return s.headers.Authorization=`Bearer ${l}`,c(s)}return Promise.reject(e)});return()=>{c.interceptors.request.eject(a),c.interceptors.response.eject(i)}},[o,t]),n(c)},C=()=>{const n=x(m),o=async t=>{t.preventDefault();const a=new FormData(t.target),i=a.get("title"),e=a.get("description");n({title:i,description:e}).then(s=>{console.log("Channel created = ",s)}).catch(s=>s?.errors?.[0]?alert(s?.errors?.[0].msg):alert("An unknown error occur"))};return r.jsxs("main",{children:[r.jsx("h1",{children:"MAIN Chat"}),r.jsx(u,{children:"Test button"}),r.jsx("h2",{children:"New channel!"}),r.jsxs("form",{onSubmit:o,children:[r.jsx("label",{htmlFor:"title",children:"Title"}),r.jsx("input",{id:"title",name:"title"}),r.jsx("label",{htmlFor:"description",children:"Description"}),r.jsx("input",{id:"description",name:"description"}),r.jsxs(u,{type:"submit",children:["Create",r.jsx("span",{children:"â†’"})]})]})]})};export{C as default};
