import{j as e}from"./jsx-runtime.brvLbZ6j.js";import{r as u}from"./index.9-aKW1zO.js";import{B as d,G as m}from"./iconBase.YqCPaJlw.js";import{c as l,b as F}from"./index.aZD16Ifr.js";import{b as w}from"./blank-profile-picture-640.oFbwhf5W.js";import{D as C}from"./Dialog.cE_dKgUV.js";import{I as N}from"./Input.Stasp_s2.js";import{r as q,$ as f,a as y,b as k,c as R,m as D,s as S}from"./friends.skf41Mf2.js";import{B as i}from"./react-toastify.esm.4Fmdt3r8.js";import{L as p}from"./Loader.5j3Wnp7_.js";import{u as h}from"./index.jt7Q199V.js";import"./index.a4cdf180.iEdQifKq.js";import"./axios.yQ12Wcn0.js";import"./auth.Ilt-Bd4Y.js";import"./index.rS7vpNfE.js";const x=({userName:s,highlight:o,children:a})=>{const r=l(F.card,"flex","flex-nowrap","gap-[8px]","p-2","cursor-pointer",o&&"bg-[--secondary]","hover:bg-[--secondary]","relative"),t=l("grow","flex","flex-col","overflow-hidden");return e.jsxs("div",{className:r,children:[e.jsx("img",{src:w.src,alt:"Generic blank user picture",className:"rounded-full w-[48px]"}),e.jsxs("div",{className:t,children:[e.jsx("span",{className:"font-semibold truncate",children:s}),e.jsx("span",{className:"text-[--muted-foreground] truncate"})]}),e.jsx("div",{className:"self-center",children:a})]})},A=({users:s,highlightId:o,handleClick:a})=>e.jsx("ul",{children:Array.from(s.values()).map(({id:r,username:t})=>e.jsx("li",{onClick:()=>a(s.get(r)),children:e.jsx(x,{userName:t,highlight:o===r})},r))}),M=({classes:s})=>{const o=a=>{a.preventDefault();const t=new FormData(a.target).get("username");q(String(t)).then(()=>{i.success("Friend request sent")}).catch(n=>{const c=n?.errors?.[0]?n?.errors?.[0].msg:"An unknown error occur";i.error(c)})};return e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"Send friends request"}),e.jsxs("form",{className:`flex flex-wrap items-end gap-[10px] p-[15px] border-2 border-gray-300 rounded-[20px] ${s}`,onSubmit:o,method:"dialog",children:[e.jsx(N,{id:"request-username",name:"username",type:"text",placeholder:"Friend's username",children:"Username"}),e.jsx(d,{classes:"ms-auto",type:"submit",children:"Send"})]})]})};function L(s){return m({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"},child:[]}]})(s)}function z(s){return m({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 128a128 128 0 1 1 256 0A128 128 0 1 1 96 128zM0 482.3C0 383.8 79.8 304 178.3 304h91.4C368.2 304 448 383.8 448 482.3c0 16.4-13.3 29.7-29.7 29.7H29.7C13.3 512 0 498.7 0 482.3zM504 312V248H440c-13.3 0-24-10.7-24-24s10.7-24 24-24h64V136c0-13.3 10.7-24 24-24s24 10.7 24 24v64h64c13.3 0 24 10.7 24 24s-10.7 24-24 24H552v64c0 13.3-10.7 24-24 24s-24-10.7-24-24z"},child:[]}]})(s)}const B=()=>{const{friendRequests:s}=h(f);if(!s)return e.jsx(p,{});const o=r=>()=>{y(r).then(()=>{k(),i.success("Friend request accepted")}).catch(t=>{const n=t?.errors?.[0]?t?.errors?.[0].msg:"An unknown error occur";i.error(n)})},a=(r,t)=>()=>{t&&(R(r),D(r).then().catch(n=>{const c=n?.errors?.[0]?n?.errors?.[0].msg:"An unknown error occur";i.error(c)}))};return e.jsx("ul",{className:"relative",children:s.map(({id:r,username:t,unseen:n})=>e.jsx("li",{onMouseOver:a(r,n),className:n?'after:content-[" "] after:absolute after:rounded-full after:bg-[--primary] after:top-2 after:left-2 after:w-4 after:h-4':"",children:e.jsx(x,{userName:t,children:e.jsx(d,{onClick:o(r),classes:"justify-self-end",children:e.jsx(L,{})})})},r))})},Y=()=>{const{allFriends:s,currentFriendChat:o,unseenRequests:a}=h(f),r=u.useRef(null),[t,n]=u.useState(!1);if(!s)return e.jsx(p,{});const c=l("p-2",a>=1?"before:content-[attr(data-amount)]":"before:content-[]","before:text-xs before:text-[--primary-foreground] before:absolute before:rounded-full before:bg-[--primary] before:top-[-.25rem] before:left-[-.25rem] before:w-4 before:h-4"),g=v=>{S(v)},j=()=>{r.current?.showModal(),n(!0)},b=()=>{r.current?.close(),n(!1)};return e.jsxs("aside",{className:"flex flex-col gap-2 overflow-y-auto bg-[--card]",children:[e.jsxs("div",{className:"flex justify-between items-center p-2",children:[e.jsx("span",{children:"Messages"}),e.jsx("div",{className:"relative",children:e.jsx(d,{size:"lg",variant:"secondary","data-amount":a,classes:c,onClick:j,children:e.jsx(z,{})})})]}),e.jsx("div",{className:"overflow-y-auto",children:e.jsx(A,{users:s,highlightId:o?.id,handleClick:g})}),e.jsxs(C,{title:"Friends requests",ref:r,handleClose:b,children:[e.jsx(M,{}),t&&e.jsx(B,{})]})]})};export{Y as default};
