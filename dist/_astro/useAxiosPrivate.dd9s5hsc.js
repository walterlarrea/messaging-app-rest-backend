import{r as u}from"./index.pNoFJhTY.js";import{a as h,b as t}from"./axios.4P0BYSc3.js";import{s as i,$ as d}from"./auth.Ilt-Bd4Y.js";import{u as f}from"./index.flahDFoG.js";const m=()=>async()=>{const s=await h.get("/refresh",{withCredentials:!0}),o=s.data?.accessToken,a=s.data?.userId,c=s.data?.role;return i({userId:a,role:c,accessToken:o}),s.data.accessToken},A=()=>{const r=f(d);return u.useDebugValue(r,s=>s?.email?"Logged In":"Logged Out"),{auth:r,setAuth:i}},x=r=>{const{auth:s}=A(),o=m();return u.useEffect(()=>{const a=t.interceptors.request.use(e=>(e.headers.Authorization||(e.headers.Authorization=`Bearer ${s?.accessToken}`),e),e=>Promise.reject(e)),c=t.interceptors.response.use(e=>e,async e=>{const n=e?.config;if(e.response.status===403&&!n?.sent){n.sent=!0;const p=await o();return n.headers.Authorization=`Bearer ${p}`,t(n)}return Promise.reject(e)});return()=>{t.interceptors.request.eject(a),t.interceptors.response.eject(c)}},[s,o]),r(t)};export{x as u};
