import{j as e}from"./jsx-runtime.QP8Mob9_.js";import{r as l}from"./index.pNoFJhTY.js";import{$ as w,b as v}from"./chat.9QllWSSk.js";import{B as h,G as f}from"./iconBase.qhA4a5Ky.js";import{c as q,b}from"./style.PTBqZ4SP.js";import{b as y}from"./blank-profile-picture-640.oFbwhf5W.js";import{m as p}from"./axios.4P0BYSc3.js";import{u}from"./useAxiosPrivate.dd9s5hsc.js";import{D as N}from"./Dialog.xvaavLnu.js";import{I as C}from"./Input.NYImK2Vb.js";import{B as m}from"./react-toastify.esm.zUJi9Y_R.js";import{L as x}from"./Loader.-UzW9RBp.js";import{u as k}from"./index.flahDFoG.js";import"./index.rS7vpNfE.js";import"./index.a4cdf180.IHyMe0ZT.js";import"./constants.2jmUwbZT.js";import"./auth.Ilt-Bd4Y.js";const g=({userName:r,highlight:s,children:n})=>{const a=q(b.card,"flex","flex-nowrap","gap-[8px]","p-2","cursor-pointer",s&&"bg-[--secondary]","hover:bg-[--secondary]");return e.jsxs("div",{className:a,children:[e.jsx("img",{src:y.src,alt:"Generic blank user picture",className:"rounded-full w-[48px]"}),e.jsxs("div",{className:"grow flex flex-col overflow-hidden",children:[e.jsx("span",{className:"font-semibold truncate",children:r}),e.jsx("span",{className:"text-[--muted-foreground] truncate"})]}),e.jsx("div",{className:"self-center",children:n})]})},A=({users:r,highlightId:s,handleClick:n})=>e.jsx("ul",{children:r.map(({id:a,username:c},t)=>e.jsx("li",{onClick:()=>n(r[t]),children:e.jsx(g,{userName:c,highlight:s===a})},a))}),D=r=>async()=>await r.get("/api/friends/incoming-requests").then(s=>s.data).catch(p),R=r=>async()=>await r.get("/api/friends").then(s=>s.data).catch(p),U=r=>async s=>await r.post("/api/friends/request",{target_username:s}).then(n=>n.data).catch(p),S=r=>async s=>await r.patch("/api/friends/request",{req_user_id:s}).then(n=>n.data).catch(p),L=({classes:r})=>{const s=u(U),n=a=>{a.preventDefault();const t=new FormData(a.target).get("username");s(t).then(()=>{m.success("Friend request sent")}).catch(o=>{const i=o?.errors?.[0]?o?.errors?.[0].msg:"An unknown error occur";m.error(i)})};return e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"Send friends request"}),e.jsxs("form",{className:`flex flex-wrap items-end gap-[10px] p-[15px] border-2 border-gray-300 rounded-[20px] ${r}`,onSubmit:n,method:"dialog",children:[e.jsx(C,{id:"request-username",name:"username",type:"text",placeholder:"Friend's username",children:"Username"}),e.jsx(h,{classes:"ms-auto",type:"submit",children:"Send"})]})]})};function M(r){return f({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"},child:[]}]})(r)}function z(r){return f({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 128a128 128 0 1 1 256 0A128 128 0 1 1 96 128zM0 482.3C0 383.8 79.8 304 178.3 304h91.4C368.2 304 448 383.8 448 482.3c0 16.4-13.3 29.7-29.7 29.7H29.7C13.3 512 0 498.7 0 482.3zM504 312V248H440c-13.3 0-24-10.7-24-24s10.7-24 24-24h64V136c0-13.3 10.7-24 24-24s24 10.7 24 24v64h64c13.3 0 24 10.7 24 24s-10.7 24-24 24H552v64c0 13.3-10.7 24-24 24s-24-10.7-24-24z"},child:[]}]})(r)}const B=()=>{const[r,s]=l.useState(),n=u(D),a=u(S);if(l.useEffect(()=>{n().then(t=>{s(t)}).catch(t=>{const o=t?.errors?.[0]?t?.errors?.[0].msg:"An unknown error occur";m.error(o)})},[]),!r)return e.jsx(x,{});const c=t=>()=>{m.promise(a(t),{pending:"Approving friend request",success:"Friend request successfully approved",error:{render({data:o}){const{errors:i}=o;return i?.[0]?i?.[0].msg:"An unknown error occur"}}})};return e.jsx("ul",{children:r.map(({id:t,username:o})=>e.jsx("li",{children:e.jsx(g,{userName:o,children:e.jsx(h,{onClick:c(t),classes:"justify-self-end",children:e.jsx(M,{})})})},t))})},ee=()=>{const r=k(w),[s,n]=l.useState(),a=l.useRef(null),[c,t]=l.useState(!1),o=u(R);if(l.useEffect(()=>{o().then(d=>{n(d)}).catch(d=>{d?.errors?.[0]?alert(d?.errors?.[0].msg):alert("An unknown error occur"),window.location.href="/"})},[]),!s)return e.jsx(x,{});const i=d=>{v(d)},j=()=>{a.current?.showModal(),t(!0)},F=()=>{a.current?.close(),t(!1)};return e.jsxs("aside",{className:"flex flex-col gap-2 overflow-y-auto bg-[--card]",children:[e.jsxs("div",{className:"flex justify-between items-center p-2",children:[e.jsx("span",{children:"Messages"}),e.jsx(h,{size:"lg",variant:"secondary",classes:"p-2",onClick:j,children:e.jsx(z,{})})]}),e.jsx("div",{className:"overflow-y-auto",children:e.jsx(A,{users:s,highlightId:r.currentUser?.id,handleClick:i})}),e.jsxs(N,{title:"Friends requests",ref:a,handleClose:F,children:[e.jsx(L,{}),c&&e.jsx(B,{})]})]})};export{ee as default};
