import{j as t}from"./jsx-runtime.QP8Mob9_.js";import{r as i}from"./index.pNoFJhTY.js";import{s as f,$ as p,a as h}from"./chat.9QllWSSk.js";import{u as x}from"./index.flahDFoG.js";import{u as m}from"./useAxiosPrivate.dd9s5hsc.js";import{m as g}from"./axios.4P0BYSc3.js";import{B as u}from"./react-toastify.esm.zUJi9Y_R.js";import{c as C,s as j,a as w}from"./style.PTBqZ4SP.js";import{I as M}from"./Input.NYImK2Vb.js";import{G as S,B as y}from"./iconBase.qhA4a5Ky.js";import{S as N}from"./wsGlobalHandler.P3KhmRl2.js";import"./index.rS7vpNfE.js";import"./auth.Ilt-Bd4Y.js";import"./constants.2jmUwbZT.js";import"./index.a4cdf180.IHyMe0ZT.js";const v=e=>async s=>await e.get(`/api/message/${s}`).then(r=>r.data).catch(g),b=e=>async({targetUserId:s,content:r})=>await e.post("/api/message",{target_user_id:s,content:r}).then(n=>n.data).catch(g),U=({content:e,date:s,isMine:r})=>{const o=C(r?"self-end":"self-start",r?j.accent:w.primary,"p-2","max-w-[400px]","rounded-[--radius]");return t.jsxs("section",{className:`flex ${o}`,children:[t.jsx("span",{className:"self-start",children:e}),t.jsx("small",{className:"ps-2 self-end text-[--muted-foreground]",children:String(s)})]})};function A(e){return S({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{d:"M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z"},child:[]}]})(e)}const E=({submitNewMessage:e})=>{const[s,r]=i.useState(""),n=o=>{o.preventDefault(),!(!s||s.length<=0)&&e(s).then(()=>r(""))};return t.jsxs("form",{autoComplete:"off",onSubmit:n,className:"flex justify-between items-center gap-2",children:[t.jsx(M,{type:"text",boxSize:"lg",id:"message-text",name:"message",placeholder:" Message",value:s,onChange:o=>r(o.target.value)}),t.jsx(y,{type:"submit",size:"lg",classes:"h-full text-5xl",disabled:s.length<=0,children:t.jsx(A,{})})]})},W=()=>{const e=x(p),s=m(v),r=m(b),n=i.useRef(null);i.useEffect(()=>{e.currentUser?.id&&s(e.currentUser.id).then(a=>f(a)).catch(a=>{const l=a?.errors?.[0]?a?.errors?.[0].msg:"An unknown error occur";u.error(l)})},[e.currentUser?.id]),i.useEffect(()=>{n.current&&(n.current.scrollTop=n.current.scrollHeight)},[e.messages,e.messages?.length]);const o=async a=>{const l={targetUserId:e.currentUser.id,content:a};return await r(l).then(c=>(h(c),N.emit("sendMessage",c),!0)).catch(c=>{const d=c?.errors?.[0]?c?.errors?.[0].msg:"An unknown error occur";return u.error(d),!1})};return t.jsx("main",{className:"p-4 overflow-y-auto bg-[--accent]",children:t.jsxs("div",{className:"flex flex-col gap-4 h-full",children:[t.jsx("div",{ref:n,className:"flex flex-col gap-1 overflow-y-auto grow",children:e.messages?.map(a=>t.jsx(U,{isMine:a.senderId!==e.currentUser?.id,content:a.content,date:a.date},a.id))}),e.currentUser&&t.jsx(E,{submitNewMessage:o})]})})};export{W as default};
